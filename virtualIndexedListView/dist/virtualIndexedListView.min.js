angular.module("virtualIndexedListView",["rx"]);var VirtualIndexedListView;!function(e){var t=function(){function e(e,t){var i=this;this.getHtml=e,this.virtualIndexedListViewRenderer=t,this.restirct="A",this.transclude="element",this.scope=!1,this.compile=function(e){function t(e){e[0].removeAttribute("virtual-indexed-list-view"),e[0].removeAttribute("virtual-indexed-list-view-collection-name"),e[0].removeAttribute("virtual-indexed-list-view-item-name"),e[0].removeAttribute("virtual-indexed-list-view-item-height"),e[0].removeAttribute("virtual-indexed-list-view-items")}var n=i.virtualIndexedListViewRenderer,r=e.parent(),l=i.getHtml;return function(e,i,o,a,d){d(e.$new(),function(i){t(i),n.createInstance({element:angular.element(r),template:l(i[0],!0),scope:e,items:o.virtualIndexedListViewItems?JSON.parse(o.virtualIndexedListViewItems):e[o.virtualIndexedListViewCollectionName],itemName:o.virtualIndexedListViewItemName,itemHeight:o.virtualIndexedListViewItemHeight}).render()})}}}return e.createInstance=function(t,i){return new e(t,i)},e}();e.VirtualIndexedListView=t,angular.module("virtualIndexedListView").directive("virtualIndexedListView",["virtualIndexedListView.getHtml","virtualIndexedListViewRenderer",t.createInstance])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.None=2]="None"}(e.ScrollingDirection||(e.ScrollingDirection={}));e.ScrollingDirection}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e,t){if(!e||!e.tagName)return"";var i,n,r=document.createElement("div");return r.appendChild(e.cloneNode(!1)),i=r.innerHTML,t&&(n=i.indexOf(">")+1,i=i.substring(0,n)+e.innerHTML+i.substring(n)),r=null,i};angular.module("virtualIndexedListView").value("virtualIndexedListView.getHtml",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e){for(var t=[],i=0;i<e.renderedNodes.length;i++){var n=e.getY(e.renderedNodes[i]),r=e.renderedNodes[i].offsetTop,l=e.itemHeight;t.push({top:n+r,bottom:n+r+l,index:angular.element(e.renderedNodes[i]).scope().$$index,node:e.renderedNodes[i]})}return e.desc?t.sort(function(e,t){return t.top-e.top}):t.sort(function(e,t){return e.top-t.top}),t};angular.module("virtualIndexedListView").value("virtualIndexedListView.getRenderedNodesComputedInfo",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(t,i){return i&&t>i?e.ScrollingDirection.Down:i&&i>t?e.ScrollingDirection.Up:i&&t===i?e.ScrollingDirection.None:null};angular.module("virtualIndexedListView").value("virtualIndexedListView.getScrollDirection",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.getY=function(e){var t=angular.element(e).css("transform");return"none"===t?0:JSON.parse(t.replace(/^\w+\(/,"[").replace(/\)$/,"]"))[5]},angular.module("virtualIndexedListView").value("virtualIndexedListView.getY",e.getY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.transformY=function(e,t){return angular.element(e).css({"-moz-transform":"translateY("+t+"px)","-webkit-transform":"translateY("+t+"px)","-ms-transform":"translateY("+t+"px)","-transform":"translateY("+t+"px)"}),e},angular.module("virtualIndexedListView").value("virtualIndexedListView.transformY",e.transformY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(){var t=this;this.createInstance=function(t){var i=new e,n=angular.element("<div class='container'></div>");return t.element.append(n),i.augmentedJQuery=t.element.find(".container"),i},this.reInitialize=function(e){for(var i=0;i<t.htmlElement.children.length;i++){var n=angular.element(t.htmlElement.children[i]).scope();n.$destroy()}t.htmlElement.innerHTML="",t.setHeight(e.height)},this.setHeight=function(e){t.augmentedJQuery.css("height",e)}}return Object.defineProperty(e.prototype,"height",{get:function(){return this.htmlElement.offsetHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.htmlElement.offsetHeight+this.htmlElement.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.htmlElement.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"augmentedJQuery",{get:function(){return this._augmentedJQuery},set:function(e){this._augmentedJQuery=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"htmlElement",{get:function(){return this.augmentedJQuery[0]},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.container",[t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.$window=t,this.createInstance=function(t){var n=new e(i.$window);return n.scrollableParentElement=n.getScrollableParent(t.element[0]),n},this.getScrollableParent=function(e){if("HTML"==e.tagName)return null;var t=angular.element(e).css("overflowY");return"scroll"==t||"auto"==t?angular.element(e):e.parentNode?i.getScrollableParent(e.parentNode):void 0}}return Object.defineProperty(e.prototype,"scrollY",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].scrollTop:this.$window.pageYOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].offsetHeight:this.$window.innerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.scrollY+this.height},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.viewPort",["$window",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(){function t(i,n,r,l,o,a,d,s,u){var c=this;this.$compile=i,this.$injector=n,this.$interval=r,this.$timeout=l,this.getRenderedNodesComputedInfo=o,this.getScrollDirection=a,this.getY=d,this.observeOnScope=s,this.transformY=u,this.createInstance=function(e){var i=new t(c.$compile,c.$injector,c.$interval,c.$timeout,c.getRenderedNodesComputedInfo,c.getScrollDirection,c.getY,c.observeOnScope,c.transformY);i.items=e.items,i.itemName=e.itemName,i.scope=e.scope,i.element=e.element,i.template=e.template,i.itemHeight=Number(e.itemHeight),i.viewPort=c.$injector.get("virtualIndexedListView.viewPort").createInstance({element:i.element}),i.container=c.$injector.get("virtualIndexedListView.container").createInstance({element:i.element}),i.container.setHeight(i.items.length*i.itemHeight),i.numberOfRenderedItems>i.items.length&&(i.numberOfRenderedItems=i.items.length),i.$interval(function(){i.render({scrollY:i.viewPort.scrollY,lastScrollY:i.lastYScroll,viewPortHeight:i.viewPort.height}),i.lastYScroll=i.viewPort.scrollY},10,null,!1);var n=null;return i.observeOnScope(i.scope,"vm.filterTerm").map(function(e){return e}).subscribe(function(e){i.filterTerm.observedChange=e,i.filterTerm.newValue=e.newValue,i.filterTerm.oldValue=e.oldValue,i.filterFn=function(e){return e.name.indexOf(i.filterTerm.newValue)>-1},n&&i.$timeout.cancel(n),n=i.$timeout(function(){i.render({force:!0,lastScrollY:0,scrollY:0,viewPortHeight:i.viewPort.height})},10,!1)}),i.filterFn=i.scope.filterFn,i},this._filterTerm={},this.render=function(t){return t||(t={lastScrollY:0,scrollY:0,viewPortHeight:c.viewPort.height}),t.force?void c.forceRender(t):(c.hasRendered===!1&&c.initialRender(t),c.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Down?void c.renderDown(t):c.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Up?void c.renderUp(t):c.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.None?void c.stabilizeRender(t):void 0)},this.forceRender=function(e){if(c.hasRendered){c.container.reInitialize({height:c.items.length*c.itemHeight}),c.initialRender(e);try{c.scope.$digest()}catch(t){}}},this.initialRender=function(e){for(var t=0;t<c.numberOfRenderedItems;t++){var i=c.scope.$new(!0);i[c.itemName]=c.items[t],i.$$index=t;var n=c.$compile(angular.element(c.template))(i);c.container.augmentedJQuery.append(n)}c.hasRendered=!0},this.renderDown=function(e){var t=!1,i=!1,n=null,r=null;do{var l=c.getRenderedNodesComputedInfo({getY:c.getY,renderedNodes:c.container.htmlElement.children,itemHeight:c.itemHeight,desc:!1});if(l[l.length-1].bottom>=c.container.bottom?t=!0:(r=l[l.length-1].index+1,n=c.items[r]),l[0].bottom>=e.scrollY&&(i=!0),!t&&!i){c.transformY(l[0].node,c.numberOfRenderedItems*c.itemHeight+c.getY(l[0].node));var o=angular.element(l[0].node).scope();o[c.itemName]=n,o.$$index=r,o.$digest()}}while(!t&&!i)},this.renderUp=function(e){var t=!1,i=!1,n=null,r=null;do{var l=c.getRenderedNodesComputedInfo({getY:c.getY,renderedNodes:c.container.htmlElement.children,itemHeight:c.itemHeight,desc:!0});if(l[l.length-1].top<=0?t=!0:(r=l[l.length-1].index-1,n=c.items[r]),l[0].top<=e.scrollY+e.viewPortHeight&&(i=!0),!t&&!i){c.transformY(l[0].node,c.getY(l[0].node)-c.numberOfRenderedItems*c.itemHeight);var o=angular.element(l[0].node).scope();o[c.itemName]=n,o.$$index=r,o.$digest()}}while(!t&&!i)},this.stabilizeRender=function(e){var t=c.getRenderedNodesComputedInfo({getY:c.getY,renderedNodes:c.container.htmlElement.children,itemHeight:c.itemHeight,desc:!1}),i=t[0].top,n=t[t.length-1].bottom;i>e.scrollY&&console.log("missing items on top"),n<=e.scrollY+e.viewPortHeight&&c.renderDown(e)},this.hasRendered=!1,this.lastYScroll=0}return Object.defineProperty(t.prototype,"filterTerm",{get:function(){return this._filterTerm},set:function(e){this._filterTerm=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerHeight",{get:function(){return this.items.length*this.itemHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.filterFn&&this.filterTerm.newValue?this._items.filter(this.filterFn):this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfRenderedItems",{get:function(){return this._numberOfRenderedItems?this._numberOfRenderedItems:Math.ceil(1380/Number(this.itemHeight))},set:function(e){this._numberOfRenderedItems=e},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListViewRenderer",["$compile","$injector","$interval","$timeout","virtualIndexedListView.getRenderedNodesComputedInfo","virtualIndexedListView.getScrollDirection","virtualIndexedListView.getY","observeOnScope","virtualIndexedListView.transformY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));
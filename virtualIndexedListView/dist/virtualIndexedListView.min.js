angular.module("virtualIndexedListView",["rx"]);var VirtualIndexedListView;!function(e){var t=function(){function e(e,t){var i=this;this.getHtml=e,this.virtualIndexedListViewRenderer=t,this.restirct="A",this.transclude="element",this.scope=!1,this.compile=function(e){function t(e){e[0].removeAttribute("virtual-indexed-list-view"),e[0].removeAttribute("virtual-indexed-list-view-collection-name"),e[0].removeAttribute("virtual-indexed-list-view-item-name"),e[0].removeAttribute("virtual-indexed-list-view-item-height"),e[0].removeAttribute("virtual-indexed-list-view-items"),e[0].removeAttribute("virtual-indexed-list-view-name"),e[0].removeAttribute("virtual-indexed-list-view-data-service")}var n=i.virtualIndexedListViewRenderer,r=e.parent(),o=i.getHtml;return function(e,i,l,a,s){s(e.$new(),function(i){t(i),n.createInstance({element:angular.element(r),template:o(i[0],!0),scope:e,items:l.virtualIndexedListViewItems?JSON.parse(l.virtualIndexedListViewItems):e[l.virtualIndexedListViewCollectionName],itemName:l.virtualIndexedListViewItemName,itemHeight:l.virtualIndexedListViewItemHeight,name:l.virtualIndexedListViewName,dataService:l.virtualIndexedListViewDataService}).render()})}}}return e.createInstance=function(t,i){return new e(t,i)},e}();e.VirtualIndexedListView=t,angular.module("virtualIndexedListView").directive("virtualIndexedListView",["virtualIndexedListView.getHtml","virtualIndexedListViewRenderer",t.createInstance])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.collection=0]="collection",e[e.scope=1]="scope",e[e.filterable=2]="filterable",e[e.lazyLoad=3]="lazyLoad"}(e.collectionType||(e.collectionType={}));e.collectionType}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.None=2]="None"}(e.ScrollingDirection||(e.ScrollingDirection={}));e.ScrollingDirection}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e,t){if(!e||!e.tagName)return"";var i,n,r=document.createElement("div");return r.appendChild(e.cloneNode(!1)),i=r.innerHTML,t&&(n=i.indexOf(">")+1,i=i.substring(0,n)+e.innerHTML+i.substring(n)),r=null,i};angular.module("virtualIndexedListView").value("virtualIndexedListView.getHtml",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e){for(var t=[],i=0;i<e.renderedNodes.length;i++){var n=e.getY(e.renderedNodes[i]),r=e.renderedNodes[i].offsetTop,o=e.itemHeight;t.push({top:n+r,bottom:n+r+o,index:angular.element(e.renderedNodes[i]).scope().$$index,node:e.renderedNodes[i]})}return e.desc?t.sort(function(e,t){return t.top-e.top}):t.sort(function(e,t){return e.top-t.top}),t};angular.module("virtualIndexedListView").value("virtualIndexedListView.getRenderedNodesComputedInfo",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(t,i){return i&&t>i?e.ScrollingDirection.Down:i&&i>t?e.ScrollingDirection.Up:i&&t===i?e.ScrollingDirection.None:null};angular.module("virtualIndexedListView").value("virtualIndexedListView.getScrollDirection",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.getY=function(e){var t=angular.element(e).css("transform");return"none"===t?0:JSON.parse(t.replace(/^\w+\(/,"[").replace(/\)$/,"]"))[5]},angular.module("virtualIndexedListView").value("virtualIndexedListView.getY",e.getY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.transformY=function(e,t){return angular.element(e).css({"-moz-transform":"translateY("+t+"px)","-webkit-transform":"translateY("+t+"px)","-ms-transform":"translateY("+t+"px)","-transform":"translateY("+t+"px)"}),e},angular.module("virtualIndexedListView").value("virtualIndexedListView.transformY",e.transformY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.$q=t,this.createInstance=function(t){var n=new e(i.$q);return n.items=t.items,n.numberOfItems=t.items.length,n},this.getIndexByCriteriaAsync=function(e){for(var t=i.$q.defer(),n=null,r=0;r<i.items.length;r++)i.items[r][e.criteria.key]==e.criteria.value&&(n=r);return t.resolve({index:n}),t.promise},this.subscriptions=[],this.subscribe=function(e){return i.subscriptions.push({callback:e.callback,id:i.subscriptions.length+1,isActive:!0}),i.subscriptions.length}}return Object.defineProperty(e.prototype,"numberOfItems",{get:function(){return this._numberOfItems},set:function(e){this._numberOfItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.collectionManager",["$q",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(){var t=this;this.createInstance=function(t){var i=new e,n=angular.element("<div class='container'></div>");return t.element.append(n),i.augmentedJQuery=t.element.find(".container"),i},this.reInitialize=function(e){for(var i=0;i<t.htmlElement.children.length;i++){var n=angular.element(t.htmlElement.children[i]).scope();n.$destroy()}t.htmlElement.innerHTML="",t.setHeight(e.height)},this.setHeight=function(e){t.augmentedJQuery.css("height",e)}}return Object.defineProperty(e.prototype,"height",{get:function(){return this.htmlElement.offsetHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.htmlElement.offsetHeight+this.htmlElement.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.htmlElement.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"augmentedJQuery",{get:function(){return this._augmentedJQuery},set:function(e){this._augmentedJQuery=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"htmlElement",{get:function(){return this.augmentedJQuery[0]},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.container",[t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t,i,n){var r=this;this.$q=t,this.$timeout=i,this.observeOnScope=n,this.createInstance=function(t){var i=new e(r.$q,r.$timeout,r.observeOnScope);i.items=t.items,i.numberOfItems=t.items.length;var n=null;return i.observeOnScope(t.scope,t.searchTermNameOnScope).map(function(e){return e}).subscribe(function(e){e.oldValue!=e.newValue&&(t.filterFn=function(t){return t.name.indexOf(e.newValue)>-1},n&&i.$timeout.cancel(n),n=i.$timeout(function(){for(var e=0;e<i.subscriptions.length;e++)i.subscriptions[e].callback()},10,!1))}),i},this.getIndexByCriteriaAsync=function(e){var t=r.$q.defer();return t.resolve(!0),t.promise},this.subscriptions=[],this.subscribe=function(e){return r.subscriptions.push({callback:e.callback,id:r.subscriptions.length+1,isActive:!0}),r.subscriptions.length}}return Object.defineProperty(e.prototype,"numberOfItems",{get:function(){return this._numberOfItems},set:function(e){this._numberOfItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.filterableCollectionManager",["$q","$timeout","observeOnScope",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t,i){var n=this;this.$injector=t,this.$q=i,this.createInstance=function(t){var i=new e(n.$injector,n.$q);return i.items=t.items,i.numberOfItems=t.items.length,i.dataService=i.$injector.get(t.dataService),i.dataService.search({}).then(function(e){i.numberOfItems=e.data.TotalHits;for(var t=0;t<e.data.TotalHits;t++)i.items.push(null);for(var t=0;t<e.data.Data.length;t++)i.items[t]=e.data.Data[t].Item;for(var t=0;t<i.subscriptions.length;t++)i.subscriptions[t].callback()}),i},this.getIndexByCriteriaAsync=function(e){for(var t=n.$q.defer(),i=null,r=0;r<n.items.length;r++)n.items[r][e.criteria.key]==e.criteria.value&&(i=r);return t.resolve({index:i}),t.promise},this.loadMore=function(){var e=n.lastLoadedIndex;n.loaded||n.dataService.search({params:{offset:e,pageSize:n.pageSize}}).then(function(t){for(var i=0;i<t.data.Data.length;i++)n.items[i+e]=t.data.Data[i].Item})},this.subscriptions=[],this.subscribe=function(e){return n.subscriptions.push({callback:e.callback,id:n.subscriptions.length+1,isActive:!0}),n.subscriptions.length}}return Object.defineProperty(e.prototype,"loaded",{get:function(){for(var e=!0,t=0;t<this.items.length;t++)null===this.items[t]&&(e=!1,t=this.items.length);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastLoadedIndex",{get:function(){for(var e=null,t=0;t<this.items.length;t++)null===this.items[t]&&null===e&&(e=t,t=this.items.length);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageSize",{get:function(){return 128},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfItems",{get:function(){return this._numberOfItems},set:function(e){this._numberOfItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.lazyLoadCollectionManager",["$injector","$q",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.$window=t,this.createInstance=function(t){var n=new e(i.$window);return n.scrollableParentElement=n.getScrollableParent(t.element[0]),n},this.getScrollableParent=function(e){if("HTML"==e.tagName)return null;var t=angular.element(e).css("overflowY");return"scroll"==t||"auto"==t?angular.element(e):e.parentNode?i.getScrollableParent(e.parentNode):void 0},this.scrollTo=function(e){i.scrollableParentElement?i.scrollableParentElement[0].scrollTop=e:i.$window.scrollTo(0,e)}}return Object.defineProperty(e.prototype,"scrollY",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].scrollTop:this.$window.pageYOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].offsetHeight:this.$window.innerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.scrollY+this.height},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.viewPort",["$window",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(){function t(i,n,r,o,l,a,s,c){var u=this;this.$compile=i,this.$injector=n,this.$interval=r,this.getRenderedNodesComputedInfo=o,this.getScrollDirection=l,this.getY=a,this.observeOnScope=s,this.transformY=c,this.createInstance=function(e){var i=new t(u.$compile,u.$injector,u.$interval,u.getRenderedNodesComputedInfo,u.getScrollDirection,u.getY,u.observeOnScope,u.transformY);return i.itemName=e.itemName,i.scope=e.scope,i.element=e.element,i.template=e.template,i.itemHeight=Number(e.itemHeight),i.viewPort=u.$injector.get("virtualIndexedListView.viewPort").createInstance({element:i.element}),i.container=u.$injector.get("virtualIndexedListView.container").createInstance({element:i.element}),i.name=e.name,e.filterFn&&e.searchTermNameOnScope?i.collectionManager=u.$injector.get("virtualIndexedListView.filterableCollectionManager").createInstance({items:e.items}):e.dataService?(i.collectionManager=u.$injector.get("virtualIndexedListView.lazyLoadCollectionManager").createInstance({items:e.items,dataService:e.dataService}),i.$interval(function(){i.collectionManager.loadMore()},1e3,null,!1)):i.collectionManager=u.$injector.get("virtualIndexedListView.collectionManager").createInstance({items:e.items}),i.scope.$on(i.scrollEventName,function(e,t){i.collectionManager.getIndexByCriteriaAsync({criteria:t}).then(function(e){i.viewPort.scrollTo(e.index*i.itemHeight)})}),i.collectionManager.subscribe({callback:function(){i.forceRender({viewPortHeight:i.viewPort.height})}}),i.container.setHeight(i.collectionManager.numberOfItems*i.itemHeight),i.$interval(function(){i.render({scrollY:i.viewPort.scrollY,lastScrollY:i.lastYScroll,viewPortHeight:i.viewPort.height}),i.lastYScroll=i.viewPort.scrollY},10,null,!1),i},this.render=function(t){return t||(t={lastScrollY:0,scrollY:0,viewPortHeight:u.viewPort.height}),t.force?void u.forceRender(t):(u.hasRendered===!1&&u.initialRender(t),u.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Down?void u.renderDown(t):u.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Up?void u.renderUp(t):u.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.None?void u.stabilizeRender(t):void 0)},this.forceRender=function(e){u.hasRendered&&(u.container.reInitialize({height:u.collectionManager.numberOfItems*u.itemHeight}),u.initialRender(e),u.scope.$$phase||u.scope.$root.$$phase||u.scope.$digest())},this.initialRender=function(e){for(var t=0;t<u.numberOfRenderedItems;t++){var i=u.scope.$new(!0);i[u.itemName]=u.collectionManager.items[t],i.$$index=t;var n=u.$compile(angular.element(u.template))(i);u.container.augmentedJQuery.append(n)}u.hasRendered=!0},this.renderDown=function(e){var t=!1,i=!1,n=null,r=null;do{var o=u.getRenderedNodesComputedInfo({getY:u.getY,renderedNodes:u.container.htmlElement.children,itemHeight:u.itemHeight,desc:!1});if(o[o.length-1].bottom>=u.container.bottom?t=!0:(r=o[o.length-1].index+1,n=u.collectionManager.items[r]),o[0].bottom>=e.scrollY&&(i=!0),!t&&!i){u.transformY(o[0].node,u.numberOfRenderedItems*u.itemHeight+u.getY(o[0].node));var l=angular.element(o[0].node).scope();l[u.itemName]=n,l.$$index=r,l.$digest()}}while(!t&&!i)},this.renderUp=function(e){var t=!1,i=!1,n=null,r=null;do{var o=u.getRenderedNodesComputedInfo({getY:u.getY,renderedNodes:u.container.htmlElement.children,itemHeight:u.itemHeight,desc:!0});if(o[o.length-1].top<=0?t=!0:(r=o[o.length-1].index-1,n=u.collectionManager.items[r]),o[0].top<=e.scrollY+e.viewPortHeight&&(i=!0),!t&&!i){u.transformY(o[0].node,u.getY(o[0].node)-u.numberOfRenderedItems*u.itemHeight);var l=angular.element(o[0].node).scope();l[u.itemName]=n,l.$$index=r,l.$digest()}}while(!t&&!i)},this.stabilizeRender=function(e){var t=u.getRenderedNodesComputedInfo({getY:u.getY,renderedNodes:u.container.htmlElement.children,itemHeight:u.itemHeight,desc:!1}),i=t[0].top,n=t[t.length-1].bottom;i>e.scrollY&&u.renderUp(e),n<=e.scrollY+e.viewPortHeight&&u.renderDown(e)},this.hasRendered=!1,this.lastYScroll=0}return Object.defineProperty(t.prototype,"scrollEventName",{get:function(){return"virtualIndexedListViewScroll"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfRenderedItems",{get:function(){var e=Math.ceil(1380/Number(this.itemHeight));return this.collectionManager.numberOfItems<e?this.collectionManager.numberOfItems:e},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListViewRenderer",["$compile","$injector","$interval","virtualIndexedListView.getRenderedNodesComputedInfo","virtualIndexedListView.getScrollDirection","virtualIndexedListView.getY","observeOnScope","virtualIndexedListView.transformY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));
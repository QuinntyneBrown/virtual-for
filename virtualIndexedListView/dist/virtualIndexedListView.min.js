angular.module("virtualIndexedListView",[]);var VirtualIndexedListView;!function(e){var t=function(){function e(e,t){var i=this;this.getHtml=e,this.virtualIndexedListViewRenderer=t,this.restirct="A",this.transclude="element",this.scope=!1,this.compile=function(e){function t(e){e[0].removeAttribute("virtual-indexed-list-view"),e[0].removeAttribute("virtual-indexed-list-view-collection-name"),e[0].removeAttribute("virtual-indexed-list-view-item-name"),e[0].removeAttribute("virtual-indexed-list-view-item-height"),e[0].removeAttribute("virtual-indexed-list-view-items"),e[0].removeAttribute("virtual-indexed-list-view-name"),e[0].removeAttribute("virtual-indexed-list-view-data-service"),e[0].removeAttribute("virtual-indexed-list-view-search-term-name-on-scope"),e[0].removeAttribute("virtual-indexed-list-view-filter-fn-name-on-vm")}var n=i.virtualIndexedListViewRenderer,r=e.parent(),o=i.getHtml;return function(e,i,a,l,s){s(e.$new(),function(i){t(i),n.createInstance({element:angular.element(r),template:o(i[0],!0),scope:e,items:a.virtualIndexedListViewItems?JSON.parse(a.virtualIndexedListViewItems):e[a.virtualIndexedListViewCollectionName],itemName:a.virtualIndexedListViewItemName,itemHeight:a.virtualIndexedListViewItemHeight,name:a.virtualIndexedListViewName,dataService:a.virtualIndexedListViewDataService,searchTermNameOnScope:a.virtualIndexedListViewSearchTermNameOnScope,filterFnNameOnVm:a.virtualIndexedListViewFilterFnNameOnVm}).render()})}}}return e.createInstance=function(t,i){return new e(t,i)},e}();e.VirtualIndexedListView=t,angular.module("virtualIndexedListView").directive("virtualIndexedListView",["virtualIndexedListView.getHtml","virtualIndexedListViewRenderer",t.createInstance])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.collection=0]="collection",e[e.scope=1]="scope",e[e.filterable=2]="filterable",e[e.lazyLoad=3]="lazyLoad"}(e.collectionType||(e.collectionType={}));e.collectionType}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.None=2]="None"}(e.ScrollingDirection||(e.ScrollingDirection={}));e.ScrollingDirection}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e,t){if(!e||!e.tagName)return"";var i,n,r=document.createElement("div");return r.appendChild(e.cloneNode(!1)),i=r.innerHTML,t&&(n=i.indexOf(">")+1,i=i.substring(0,n)+e.innerHTML+i.substring(n)),r=null,i};angular.module("virtualIndexedListView").value("virtualIndexedListView.getHtml",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(t,i){return i&&t>i?e.ScrollingDirection.Down:i&&i>t?e.ScrollingDirection.Up:i&&t===i?e.ScrollingDirection.None:null};angular.module("virtualIndexedListView").value("virtualIndexedListView.getScrollDirection",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.getX=function(e){var t=angular.element(e).css("transform");return"none"===t?0:JSON.parse(t.replace(/^\w+\(/,"[").replace(/\)$/,"]"))[6]},angular.module("virtualIndexedListView").value("virtualIndexedListView.getX",e.getX)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.getY=function(e){var t=angular.element(e).css("transform");return"none"===t?0:JSON.parse(t.replace(/^\w+\(/,"[").replace(/\)$/,"]"))[5]},angular.module("virtualIndexedListView").value("virtualIndexedListView.getY",e.getY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(){function e(e){var t=this;this.$injector=e,this.get=function(e){switch(e["interface"]){case"ICollectionManager":return e.filterFnNameOnVm&&e.searchTermNameOnScope?t.$injector.get("virtualIndexedListView.filterableCollectionManager").createInstance({items:e.items,scope:e.scope,searchTermNameOnScope:e.searchTermNameOnScope,filterFnNameOnVm:e.filterFnNameOnVm}):e.dataService?t.$injector.get("virtualIndexedListView.lazyLoadCollectionManager").createInstance({items:e.items,dataService:e.dataService}):t.$injector.get("virtualIndexedListView.collectionManager").createInstance({items:e.items});case"IViewPort":return t.$injector.get("virtualIndexedListView.viewPort").createInstance({element:e.element});case"IContainer":return t.$injector.get("virtualIndexedListView.container").createInstance({element:e.element});case"IRenderedNodes":return t.$injector.get("virtualIndexedListView.renderedNodes").createInstance({container:e.container})}}}return e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.injector",["$injector",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.safeDigest=function(e){e.scope.$$phase||e.scope.$root.$$phase||e.scope.$digest()},angular.module("virtualIndexedListView").value("virtualIndexedListView.safeDigest",e.safeDigest)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.transformY=function(e,t){return angular.element(e).css({"-moz-transform":"translateY("+t+"px)","-webkit-transform":"translateY("+t+"px)","-ms-transform":"translateY("+t+"px)","-transform":"translateY("+t+"px)"}),e},angular.module("virtualIndexedListView").value("virtualIndexedListView.transformY",e.transformY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function t(i){var n=this;this.$q=i,this.createInstance=function(e){var i=new t(n.$q);return i.items=e.items,i.numberOfItems=e.items.length,i},this.type=e.collectionType.collection,this.getIndexByCriteriaAsync=function(e){for(var t=n.$q.defer(),i=null,r=0;r<n.items.length;r++)n.items[r][e.criteria.key]==e.criteria.value&&(i=r);return t.resolve({index:i}),t.promise},this.subscriptions=[],this.subscribe=function(e){return n.subscriptions.push({callback:e.callback,id:n.subscriptions.length+1,isActive:!0}),n.subscriptions.length}}return Object.defineProperty(t.prototype,"numberOfItems",{get:function(){return this._numberOfItems},set:function(e){this._numberOfItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListView.collectionManager",["$q",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.getY=t,this.createInstance=function(t){var n=new e(i.getY),r=angular.element("<div class='container'></div>");return t.element.append(r),n.augmentedJQuery=t.element.find(".container"),n},this.reInitialize=function(e){for(var t=0;t<i.htmlElement.children.length;t++){var n=angular.element(i.htmlElement.children[t]).scope();n.$destroy()}i.htmlElement.innerHTML="",i.setHeight(e.height)},this.setHeight=function(e){i.augmentedJQuery.css("height",e)},this.isNodeAtBottom=function(e){var t=i.getY(e.node)+e.node.offsetTop+e.node.offsetTop;return t===i.height},this.isNodeAtTop=function(e){var t=i.getY(e.node)+e.node.offsetTop;return t===i.top}}return Object.defineProperty(e.prototype,"height",{get:function(){return this.htmlElement.offsetHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.htmlElement.offsetHeight+this.htmlElement.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.htmlElement.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"augmentedJQuery",{get:function(){return this._augmentedJQuery},set:function(e){this._augmentedJQuery=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"htmlElement",{get:function(){return this.augmentedJQuery[0]},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.container",["virtualIndexedListView.getY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function t(i,n){var r=this;this.$q=i,this.$timeout=n,this.createInstance=function(e){var i=new t(r.$q,r.$timeout);return i.items=e.items,i.numberOfItems=e.items.length,i.filterFn=e.scope.vm[e.filterFnNameOnVm],e.scope.$watch(e.searchTermNameOnScope,function(e){i.searchTerm=e;for(var t=0;t<i.subscriptions.length;t++)i.subscriptions[t].callback()}),i},this.getIndexByCriteriaAsync=function(e){for(var t=r.$q.defer(),i=null,n=0;n<r.items.length;n++)r.items[n][e.criteria.key]==e.criteria.value&&(i=n);return t.resolve({index:i}),t.promise},this.subscriptions=[],this.subscribe=function(e){return r.subscriptions.push({callback:e.callback,id:r.subscriptions.length+1,isActive:!0}),r.subscriptions.length},this.type=e.collectionType.filterable}return Object.defineProperty(t.prototype,"numberOfItems",{get:function(){return this._numberOfItems},set:function(e){this._numberOfItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var e=this;return this.searchTerm&&""!=this.searchTerm?this._items.filter(function(t){return e.filterFn(t,e.searchTerm)}):this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListView.filterableCollectionManager",["$q","$timeout",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function t(i,n){var r=this;this.$injector=i,this.$q=n,this.type=e.collectionType.lazyLoad,this.createInstance=function(e){var i=new t(r.$injector,r.$q);return i.items=e.items,i.numberOfItems=e.items.length,i.dataService=i.$injector.get(e.dataService),i.dataService.search({}).then(function(e){i.numberOfItems=e.data.TotalHits;for(var t=0;t<e.data.TotalHits;t++)i.items.push(null);for(var t=0;t<e.data.Data.length;t++)i.items[t]=e.data.Data[t].Item;for(var t=0;t<i.subscriptions.length;t++)i.subscriptions[t].callback()}),i},this.getIndexByCriteriaAsync=function(e){for(var t=r.$q.defer(),i=null,n=0;n<r.items.length;n++)r.items[n][e.criteria.key]==e.criteria.value&&(i=n);return t.resolve({index:i}),t.promise},this.loadMore=function(){var e=r.lastLoadedIndex;r.loaded||r.dataService.search({params:{offset:e,pageSize:r.pageSize}}).then(function(t){for(var i=0;i<t.data.Data.length;i++)r.items[i+e]=t.data.Data[i].Item})},this.subscriptions=[],this.subscribe=function(e){return r.subscriptions.push({callback:e.callback,id:r.subscriptions.length+1,isActive:!0}),r.subscriptions.length}}return Object.defineProperty(t.prototype,"loaded",{get:function(){for(var e=!0,t=0;t<this.items.length;t++)null===this.items[t]&&(e=!1,t=this.items.length);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastLoadedIndex",{get:function(){for(var e=null,t=0;t<this.items.length;t++)null===this.items[t]&&null===e&&(e=t,t=this.items.length);return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageSize",{get:function(){return 128},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfItems",{get:function(){return this._numberOfItems},set:function(e){this._numberOfItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListView.lazyLoadCollectionManager",["$injector","$q",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t,i){var n=this;this.getX=t,this.getY=i,this.createInstance=function(t){var i=new e(n.getX,n.getY);return i.node=t.node,i}}return Object.defineProperty(e.prototype,"left",{get:function(){return this.getX(this.node)+this.node.offsetLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.getX(this.node)+this.node.offsetLeft+this.node.offsetWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.getY(this.node)+this.node.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.getY(this.node)+this.node.offsetHeight+this.node.offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scope",{get:function(){return angular.element(this.node).scope()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"$$index",{get:function(){return this.scope.$$index},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.renderedNode",["virtualIndexedListView.getX","virtualIndexedListView.getY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t,i){var n=this;this.getX=t,this.getY=i,this.createInstance=function(t){var i=new e(n.getX,n.getY);return i.container=t.container,i},this.getAll=function(e){var t;switch(e.orientation){case"horizontal":t="left";break;default:t="top"}switch(e.order){case"desc":return n.map.sort(function(e,i){return i[t]-e[t]});case"asc":return n.map.sort(function(e,i){return e[t]-i[t]})}},this.getHead=function(){var e=n.getAll({order:"asc"});return e.length<1?null:e[0]},this.getTail=function(){var e=n.getAll({order:"desc"});return e.length<1?null:e[0]},this.getHeadAndTail=function(){var e=n.getAll({order:"asc"});return e.length<1?null:{head:e[0],tail:e[e.length-1]}}}return Object.defineProperty(e.prototype,"nodes",{get:function(){return this.container.htmlElement.childNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){for(var e=[],t=this.nodes,i=0;i<t.length;i++){var n=t[i];e.push({top:this.getY(n)+n.offsetTop,left:this.getX(n)+n.offsetLeft,right:this.getX(n)+n.offsetLeft+n.offsetWidth,bottom:this.getY(n)+n.offsetTop+n.offsetHeight,index:angular.element(n).scope().$$index,node:n})}return e},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.renderedNodes",["virtualIndexedListView.getX","virtualIndexedListView.getY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.$window=t,this.createInstance=function(t){var n=new e(i.$window);return n.scrollableParentElement=n.getScrollableParent(t.element[0]),n},this.getScrollableParent=function(e){if("HTML"==e.tagName)return null;var t=angular.element(e).css("overflowY");return"scroll"==t||"auto"==t?angular.element(e):e.parentNode?i.getScrollableParent(e.parentNode):void 0},this.scrollTo=function(e){i.scrollableParentElement?i.scrollableParentElement[0].scrollTop=e:i.$window.scrollTo(0,e)}}return Object.defineProperty(e.prototype,"scrollY",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].scrollTop:this.$window.pageYOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].offsetHeight:this.$window.innerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.scrollY+this.height},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.viewPort",["$window",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(){function t(i,n,r,o,a,l){var s=this;this.$compile=i,this.$interval=n,this.getScrollDirection=r,this.getY=o,this.injector=a,this.transformY=l,this.createInstance=function(i){var n=new t(s.$compile,s.$interval,s.getScrollDirection,s.getY,s.injector,s.transformY);return n.itemName=i.itemName,n.scope=i.scope,n.element=i.element,n.template=i.template,n.itemHeight=Number(i.itemHeight),n.name=i.name,n.viewPort=s.injector.get({"interface":"IViewPort",element:n.element}),n.container=s.injector.get({"interface":"IContainer",element:n.element}),n.collectionManager=s.injector.get({"interface":"ICollectionManager",element:n.element,scope:i.scope,searchTermNameOnScope:i.searchTermNameOnScope,filterFnNameOnVm:i.filterFnNameOnVm,items:i.items,dataService:i.dataService}),n.renderedNodes=s.injector.get({"interface":"IRenderedNodes",container:n.container}),n.collectionManager.type==e.collectionType.lazyLoad&&n.$interval(function(){n.collectionManager.loadMore()},1e3,null,!1),n.scope.$on(n.scrollEventName,function(e,t){n.collectionManager.getIndexByCriteriaAsync({criteria:t}).then(function(e){n.viewPort.scrollTo(e.index*n.itemHeight)})}),n.collectionManager.subscribe({callback:function(){n.forceRender({viewPortHeight:n.viewPort.height})}}),n.container.setHeight(n.collectionManager.numberOfItems*n.itemHeight),n.$interval(function(){n.render({scrollY:n.viewPort.scrollY,lastScrollY:n.lastYScroll,viewPortHeight:n.viewPort.height}),n.lastYScroll=n.viewPort.scrollY},10,null,!1),n},this.render=function(t){return t||(t={lastScrollY:0,scrollY:0,viewPortHeight:s.viewPort.height}),t.force?void s.forceRender(t):(s.hasRendered===!1&&s.initialRender(t),s.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Down?void s.renderDown(t):s.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Up?void s.renderUp(t):s.getScrollDirection(t.scrollY,t.lastScrollY)===e.ScrollingDirection.None?void s.stabilizeRender(t):void 0)},this.forceRender=function(e){s.hasRendered&&(s.container.reInitialize({height:s.collectionManager.numberOfItems*s.itemHeight}),s.initialRender(e),s.scope.$$phase||s.scope.$root.$$phase||s.scope.$digest())},this.initialRender=function(e){for(var t=0;t<s.numberOfRenderedItems;t++){var i=s.scope.$new(!0);i[s.itemName]=s.collectionManager.items[t],i.$$index=t;var n=s.$compile(angular.element(s.template))(i);s.container.augmentedJQuery.append(n)}s.hasRendered=!0},this.renderDown=function(e){var t=!1,i=!1;do{var n=s.renderedNodes.getHeadAndTail(),r=n.tail,o=n.head;r.bottom>=s.container.bottom&&(t=!0),o.bottom>=e.scrollY&&(i=!0),t||i||s.moveAndUpdateScope({node:o.node,position:s.numberOfRenderedItems*s.itemHeight+s.getY(o.node),index:r.index+1,item:s.collectionManager.items[r.index+1]})}while(!t&&!i)},this.moveAndUpdateScope=function(e){s.transformY(e.node,e.position);var t=angular.element(e.node).scope();t[s.itemName]=e.item,t.$$index=e.index,t.$digest()},this.renderUp=function(e){var t=!1,i=!1;do{var n=s.renderedNodes.getHeadAndTail(),r=n.tail,o=n.head;r.bottom<=s.container.htmlElement.offsetTop+s.itemHeight*s.numberOfRenderedItems&&(t=!0),r.top<=s.viewPort.scrollY+s.viewPort.height&&(i=!0),t||i||s.moveAndUpdateScope({node:r.node,position:s.getY(r.node)-s.numberOfRenderedItems*s.itemHeight,index:o.index-1,item:s.collectionManager.items[o.index-1]})}while(!t&&!i)},this.stabilizeRender=function(e){var t=s.renderedNodes.getHeadAndTail(),i=t.head.top,n=t.tail.bottom;i>e.scrollY&&s.renderUp(e),n<=e.scrollY+e.viewPortHeight&&s.renderDown(e)},this.hasRendered=!1,this.lastYScroll=0}return Object.defineProperty(t.prototype,"scrollEventName",{get:function(){return"virtualIndexedListViewScroll"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfRenderedItems",{get:function(){var e=Math.ceil((this.viewPort.height+this.container.htmlElement.offsetTop)/Number(this.itemHeight));return this.collectionManager.numberOfItems<e?this.collectionManager.numberOfItems:e},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListViewRenderer",["$compile","$interval","virtualIndexedListView.getScrollDirection","virtualIndexedListView.getY","virtualIndexedListView.injector","virtualIndexedListView.transformY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));
angular.module("virtualIndexedListView",["rx"]);var VirtualIndexedListView;!function(e){var t=function(){function e(e,t){var i=this;this.getHtml=e,this.virtualIndexedListViewManager=t,this.restirct="A",this.transclude="element",this.scope=!1,this.compile=function(e){function t(e){e[0].removeAttribute("virtual-indexed-list-view"),e[0].removeAttribute("virtual-indexed-list-view-collection-name"),e[0].removeAttribute("virtual-indexed-list-view-item-name"),e[0].removeAttribute("virtual-indexed-list-view-item-height"),e[0].removeAttribute("virtual-indexed-list-view-items")}var n=i.virtualIndexedListViewManager,r=e.parent(),s=i.getHtml;return function(e,i,l,o,a){a(e.$new(),function(i){t(i),n.createInstance({element:angular.element(r),template:s(i[0],!0),scope:e,items:l.virtualIndexedListViewItems?JSON.parse(l.virtualIndexedListViewItems):e[l.virtualIndexedListViewCollectionName],itemName:l.virtualIndexedListViewItemName,itemHeight:l.virtualIndexedListViewItemHeight}).render()})}}}return e.createInstance=function(t,i){return new e(t,i)},e}();e.VirtualIndexedListView=t,angular.module("virtualIndexedListView").directive("virtualIndexedListView",["virtualIndexedListView.getHtml","virtualIndexedListViewManager",t.createInstance])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.None=2]="None"}(e.ScrollingDirection||(e.ScrollingDirection={}));e.ScrollingDirection}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.$window=t,this.createInstance=function(t){var n=new e(i.$window);return n.element=t.element,n}}return Object.defineProperty(e.prototype,"scrollY",{get:function(){return"scroll"==this.element.css("overflowY")?this.element[0].scrollTop:this.$window.pageYOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return"scroll"==this.element.css("overflowY")?this.element[0].offsetHeight:this.$window.innerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.scrollY+this.height},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.viewPort",["$window",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t,i,n,r){var s=this;this.$injector=t,this.$interval=i,this.$timeout=n,this.$window=r,this.createInstance=function(t){var i=s.$injector.get("virtualIndexedListViewRenderer"),n=new e(s.$injector,s.$interval,s.$timeout,s.$window);return n.element=t.element,n.scope=t.scope,n.template=t.template,n.virtualIndexedListViewRenderer=i.createInstance({containerHeight:t.items.length*t.itemHeight,items:t.items,itemName:t.itemName,itemHeight:t.itemHeight,element:t.element,scope:t.scope,template:t.template}),n},this.render=function(e){s.virtualIndexedListViewRenderer.render({})},this.debouceRender=function(){s.$timeout.cancel(s.timer),s.timer=s.$timeout(function(){s.render({})},250,!1)},this.onScroll=function(e){return s.lastScrollY==window.pageYOffset?void setTimeout(s.debouceRender,100):void(s.lastScrollY=window.pageYOffset)},this.lastScrollY=window.pageYOffset,this.scrollY=window.pageYOffset}return e}();angular.module("virtualIndexedListView").service("virtualIndexedListViewManager",["$injector","$interval","$timeout","$window",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(){function t(i,n,r,s,l){var o=this;this.$compile=i,this.$injector=n,this.$interval=r,this.getY=s,this.transformY=l,this.createInstance=function(e){var i=new t(o.$compile,o.$injector,o.$interval,o.getY,o.transformY);return i.containerHeight=e.containerHeight,i.items=e.items,i.itemName=e.itemName,i.scope=e.scope,i.element=e.element,i.template=e.template,i.itemHeight=Number(e.itemHeight),i.viewPort=o.$injector.get("virtualIndexedListView.viewPort").createInstance({element:i.element}),i.numberOfRenderedItems>i.items.length&&(i.numberOfRenderedItems=i.items.length),setInterval(function(){i.render({scrollY:i.viewPort.scrollY,lastScrollY:i.lastYScroll,viewPortHeight:i.viewPort.height}),i.lastYScroll=i.viewPort.scrollY},10),i},this.render=function(t){var i;if(o.hasRendered===!1){i=angular.element("<div class='container'></div>"),i.css("height",o.containerHeight),o.element.append(i);for(var n=0;n<o.numberOfRenderedItems;n++){var r=o.scope.$new(!0);r[o.itemName]=o.items[n],r.$$index=n;var s=o.$compile(angular.element(o.template))(r);i.append(s)}}if(o.getScrollDirections(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Down){var l=!1,a=!1,c=null,d=null;do{var m=o.computeCacheItemsList();if(o.cacheItemsItemList[o.cacheItemsItemList.length-1].bottom>=o.items.length*o.itemHeight?l=!0:(d=o.cacheItemsItemList[o.cacheItemsItemList.length-1].index+1,c=o.items[d]),m[0].bottom>=t.scrollY&&(a=!0),!l&&!a){o.transformY(o.cacheItemsItemList[0].node,o.numberOfRenderedItems*o.itemHeight+o.getY(o.cacheItemsItemList[0].node));var u=angular.element(o.cacheItemsItemList[0].node).scope();u[o.itemName]=c,u.$$index=d,u.$digest()}}while(!l&&!a)}if(o.getScrollDirections(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Up){var h=!1,a=!1,c=null,d=null;do{var m=o.computeCacheItemsList({desc:!0});if(o.cacheItemsItemList[o.cacheItemsItemList.length-1].top<=0?h=!0:(d=o.cacheItemsItemList[o.cacheItemsItemList.length-1].index-1,c=o.items[d]),m[0].top<=t.scrollY+t.viewPortHeight&&(a=!0),!h&&!a){o.transformY(o.cacheItemsItemList[0].node,o.getY(o.cacheItemsItemList[0].node)-o.numberOfRenderedItems*o.itemHeight);var u=angular.element(o.cacheItemsItemList[0].node).scope();u[o.itemName]=c,u.$$index=d,u.$digest()}}while(!h&&!a)}if(o.hasRendered&&o.getScrollDirections(t.scrollY,t.lastScrollY)===e.ScrollingDirection.None){var m=o.computeCacheItemsList(),I=m[0].top,g=m[m.length-1].bottom;if(I>t.scrollY&&console.log("missing items on top"),g<t.scrollY+t.viewPortHeight){console.log("missing items on bottom");var l=!1,a=!1,c=null,d=null;do{var m=o.computeCacheItemsList();if(o.cacheItemsItemList[o.cacheItemsItemList.length-1].bottom>=o.items.length*o.itemHeight?l=!0:(d=o.cacheItemsItemList[o.cacheItemsItemList.length-1].index+1,c=o.items[d]),m[0].bottom>=t.scrollY&&(a=!0),!l&&!a){o.transformY(o.cacheItemsItemList[0].node,o.numberOfRenderedItems*o.itemHeight+o.getY(o.cacheItemsItemList[0].node));var u=angular.element(o.cacheItemsItemList[0].node).scope();u[o.itemName]=c,u.$$index=d,u.$digest()}}while(!l&&!a)}}o.hasRendered=!0},this.computeCacheItemsList=function(e){o.cacheItemsItemList=[];for(var t=0;t<o.renderedNodes.length;t++){var i=o.getY(o.renderedNodes[t]),n=o.renderedNodes[t].offsetTop,r=o.itemHeight;o.cacheItemsItemList.push({top:i+n,bottom:i+n+r,index:angular.element(o.renderedNodes[t]).scope().$$index,node:o.renderedNodes[t]})}return e&&e.desc?o.cacheItemsItemList.sort(function(e,t){return t.top-e.top}):o.cacheItemsItemList.sort(function(e,t){return e.top-t.top}),o.cacheItemsItemList},this.cacheItemsItemList=[],this.getScrollDirections=function(t,i){return i&&t>i?e.ScrollingDirection.Down:i&&i>t?e.ScrollingDirection.Up:i&&t===i?e.ScrollingDirection.None:null},this.hasRendered=!1,this.lastYScroll=0}return Object.defineProperty(t.prototype,"numberOfRenderedItems",{get:function(){return this._numberOfRenderedItems?this._numberOfRenderedItems:Math.ceil(1380/Number(this.itemHeight))},set:function(e){this._numberOfRenderedItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerElement",{get:function(){return this._containerElement?this._containerElement:this.element.find(".container")},set:function(e){this._containerElement=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderedNodes",{get:function(){return this.containerElement[0].children},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListViewRenderer",["$compile","$injector","$interval","virtualIndexedListView.getY","virtualIndexedListView.transformY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e,t){if(!e||!e.tagName)return"";var i,n,r=document.createElement("div");return r.appendChild(e.cloneNode(!1)),i=r.innerHTML,t&&(n=i.indexOf(">")+1,i=i.substring(0,n)+e.innerHTML+i.substring(n)),r=null,i};angular.module("virtualIndexedListView").value("virtualIndexedListView.getHtml",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.getY=function(e){var t=angular.element(e).css("transform");return"none"===t?0:JSON.parse(t.replace(/^\w+\(/,"[").replace(/\)$/,"]"))[5]},angular.module("virtualIndexedListView").value("virtualIndexedListView.getY",e.getY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.transformY=function(e,t){return angular.element(e).css({"-moz-transform":"translateY("+t+"px)","-webkit-transform":"translateY("+t+"px)","-ms-transform":"translateY("+t+"px)","-transform":"translateY("+t+"px)"}),e},angular.module("virtualIndexedListView").value("virtualIndexedListView.transformY",e.transformY)}(VirtualIndexedListView||(VirtualIndexedListView={}));
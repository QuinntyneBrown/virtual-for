angular.module("virtualIndexedListView",["rx"]);var VirtualIndexedListView;!function(e){var t=function(){function e(e,t){var i=this;this.getHtml=e,this.virtualIndexedListViewRenderer=t,this.restirct="A",this.transclude="element",this.scope=!1,this.compile=function(e){function t(e){e[0].removeAttribute("virtual-indexed-list-view"),e[0].removeAttribute("virtual-indexed-list-view-collection-name"),e[0].removeAttribute("virtual-indexed-list-view-item-name"),e[0].removeAttribute("virtual-indexed-list-view-item-height"),e[0].removeAttribute("virtual-indexed-list-view-items")}var n=i.virtualIndexedListViewRenderer,r=e.parent(),l=i.getHtml;return function(e,i,o,s,a){a(e.$new(),function(i){t(i),n.createInstance({element:angular.element(r),template:l(i[0],!0),scope:e,items:o.virtualIndexedListViewItems?JSON.parse(o.virtualIndexedListViewItems):e[o.virtualIndexedListViewCollectionName],itemName:o.virtualIndexedListViewItemName,itemHeight:o.virtualIndexedListViewItemHeight}).render()})}}}return e.createInstance=function(t,i){return new e(t,i)},e}();e.VirtualIndexedListView=t,angular.module("virtualIndexedListView").directive("virtualIndexedListView",["virtualIndexedListView.getHtml","virtualIndexedListViewRenderer",t.createInstance])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.None=2]="None"}(e.ScrollingDirection||(e.ScrollingDirection={}));e.ScrollingDirection}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(e,t){if(!e||!e.tagName)return"";var i,n,r=document.createElement("div");return r.appendChild(e.cloneNode(!1)),i=r.innerHTML,t&&(n=i.indexOf(">")+1,i=i.substring(0,n)+e.innerHTML+i.substring(n)),r=null,i};angular.module("virtualIndexedListView").value("virtualIndexedListView.getHtml",t)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.getY=function(e){var t=angular.element(e).css("transform");return"none"===t?0:JSON.parse(t.replace(/^\w+\(/,"[").replace(/\)$/,"]"))[5]},angular.module("virtualIndexedListView").value("virtualIndexedListView.getY",e.getY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){e.transformY=function(e,t){return angular.element(e).css({"-moz-transform":"translateY("+t+"px)","-webkit-transform":"translateY("+t+"px)","-ms-transform":"translateY("+t+"px)","-transform":"translateY("+t+"px)"}),e},angular.module("virtualIndexedListView").value("virtualIndexedListView.transformY",e.transformY)}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){var t=function(){function e(t){var i=this;this.$window=t,this.createInstance=function(t){var n=new e(i.$window);return n.scrollableParentElement=n.getScrollableParent(t.element[0]),n},this.getScrollableParent=function(e){if("HTML"==e.tagName)return null;var t=angular.element(e).css("overflowY");return"scroll"==t||"auto"==t?angular.element(e):e.parentNode?i.getScrollableParent(e.parentNode):void 0}}return Object.defineProperty(e.prototype,"scrollY",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].scrollTop:this.$window.pageYOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scrollableParentElement?this.scrollableParentElement[0].offsetHeight:this.$window.innerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.scrollY+this.height},enumerable:!0,configurable:!0}),e}();angular.module("virtualIndexedListView").service("virtualIndexedListView.viewPort",["$window",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));var VirtualIndexedListView;!function(e){"use strict";var t=function(){function t(i,n,r,l,o,s,a){var c=this;this.$compile=i,this.$injector=n,this.$interval=r,this.$timeout=l,this.getY=o,this.observeOnScope=s,this.transformY=a,this.createInstance=function(e){var i=new t(c.$compile,c.$injector,c.$interval,c.$timeout,c.getY,c.observeOnScope,c.transformY);i.items=e.items,i.itemName=e.itemName,i.scope=e.scope,i.element=e.element,i.template=e.template,i.itemHeight=Number(e.itemHeight),i.viewPort=c.$injector.get("virtualIndexedListView.viewPort").createInstance({element:i.element}),i.numberOfRenderedItems>i.items.length&&(i.numberOfRenderedItems=i.items.length),i.$interval(function(){i.render({scrollY:i.viewPort.scrollY,lastScrollY:i.lastYScroll,viewPortHeight:i.viewPort.height}),i.lastYScroll=i.viewPort.scrollY},10,null,!1);var n=null;return i.observeOnScope(i.scope,"vm.filterTerm").map(function(e){return e}).subscribe(function(e){i.filterTerm.observedChange=e,i.filterTerm.newValue=e.newValue,i.filterTerm.oldValue=e.oldValue,i.filterFn=function(e){return e.name.indexOf(i.filterTerm.newValue)>-1},n&&i.$timeout.cancel(n),n=i.$timeout(function(){i.render({force:!0,lastScrollY:0,scrollY:0,viewPortHeight:i.viewPort.height})},10,!1)}),i.filterFn=i.scope.filterFn,i},this._filterTerm={},this.render=function(t){t||(t={lastScrollY:0,scrollY:0,viewPortHeight:c.viewPort.height});var i;if(t.force){for(var n=c.containerElement[0],r=0;r<n.children.length;r++){var l=angular.element(n.children[r]).scope();l.$destroy()}n.innerHTML="",angular.element(n).css("height",c.containerHeight);for(var r=0;r<c.numberOfRenderedItems;r++){var o=c.scope.$new(!0);o[c.itemName]=c.items[r],o.$$index=r;var s=c.$compile(angular.element(c.template))(o);angular.element(n).append(s)}try{c.scope.$digest()}catch(a){}c.hasRendered=!0}if(c.hasRendered===!1){i=angular.element("<div class='container'></div>"),i.css("height",c.containerHeight),c.element.append(i);for(var r=0;r<c.numberOfRenderedItems;r++){var o=c.scope.$new(!0);o[c.itemName]=c.items[r],o.$$index=r;var s=c.$compile(angular.element(c.template))(o);i.append(s)}var m=c.computeCacheItemsList();try{c.scope.$digest()}catch(a){}}if(c.getScrollDirections(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Down){var u=!1,d=!1,h=null,f=null;do{var m=c.computeCacheItemsList();if(m[c.cacheItemsItemList.length-1].bottom>=c.containerBottom?u=!0:(f=c.cacheItemsItemList[c.cacheItemsItemList.length-1].index+1,h=c.items[f]),m[0].bottom>=t.scrollY&&(d=!0),!u&&!d){c.transformY(c.cacheItemsItemList[0].node,c.numberOfRenderedItems*c.itemHeight+c.getY(c.cacheItemsItemList[0].node));var g=angular.element(c.cacheItemsItemList[0].node).scope();g[c.itemName]=h,g.$$index=f,g.$digest()}}while(!u&&!d)}if(c.getScrollDirections(t.scrollY,t.lastScrollY)===e.ScrollingDirection.Up){var I=!1,d=!1,h=null,f=null;do{var m=c.computeCacheItemsList({desc:!0});if(c.cacheItemsItemList[c.cacheItemsItemList.length-1].top<=0?I=!0:(f=c.cacheItemsItemList[c.cacheItemsItemList.length-1].index-1,h=c.items[f]),m[0].top<=t.scrollY+t.viewPortHeight&&(d=!0),!I&&!d){c.transformY(c.cacheItemsItemList[0].node,c.getY(c.cacheItemsItemList[0].node)-c.numberOfRenderedItems*c.itemHeight);var g=angular.element(c.cacheItemsItemList[0].node).scope();g[c.itemName]=h,g.$$index=f,g.$digest()}}while(!I&&!d)}if(c.hasRendered&&c.getScrollDirections(t.scrollY,t.lastScrollY)===e.ScrollingDirection.None){var m=c.computeCacheItemsList(),v=m[0].top,p=m[m.length-1].bottom;if(v>t.scrollY&&console.log("missing items on top"),p<=t.scrollY+t.viewPortHeight){console.log("missing items on bottom");var u=!1,d=!1,h=null,f=null;do{var m=c.computeCacheItemsList();if(c.cacheItemsItemList[c.cacheItemsItemList.length-1].bottom>=c.items.length*c.itemHeight?u=!0:(f=c.cacheItemsItemList[c.cacheItemsItemList.length-1].index+1,h=c.items[f]),m[0].bottom>=t.scrollY&&(d=!0),!u&&!d){c.transformY(c.cacheItemsItemList[0].node,c.numberOfRenderedItems*c.itemHeight+c.getY(c.cacheItemsItemList[0].node));var g=angular.element(c.cacheItemsItemList[0].node).scope();g[c.itemName]=h,g.$$index=f,g.$digest()}}while(!u&&!d)}}c.hasRendered=!0},this.computeCacheItemsList=function(e){c.cacheItemsItemList=[];for(var t=0;t<c.renderedNodes.length;t++){var i=c.getY(c.renderedNodes[t]),n=c.renderedNodes[t].offsetTop,r=c.itemHeight;c.cacheItemsItemList.push({top:i+n,bottom:i+n+r,index:angular.element(c.renderedNodes[t]).scope().$$index,node:c.renderedNodes[t]})}return e&&e.desc?c.cacheItemsItemList.sort(function(e,t){return t.top-e.top}):c.cacheItemsItemList.sort(function(e,t){return e.top-t.top}),c.cacheItemsItemList},this.cacheItemsItemList=[],this.getScrollDirections=function(t,i){return i&&t>i?e.ScrollingDirection.Down:i&&i>t?e.ScrollingDirection.Up:i&&t===i?e.ScrollingDirection.None:null},this.hasRendered=!1,this.lastYScroll=0}return Object.defineProperty(t.prototype,"filterTerm",{get:function(){return this._filterTerm},set:function(e){this._filterTerm=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerHeight",{get:function(){return this.items.length*this.itemHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this.filterFn&&this.filterTerm.newValue?this._items.filter(this.filterFn):this._items},set:function(e){this._items=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfRenderedItems",{get:function(){return this._numberOfRenderedItems?this._numberOfRenderedItems:Math.ceil(1380/Number(this.itemHeight))},set:function(e){this._numberOfRenderedItems=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerElement",{get:function(){return this._containerElement?this._containerElement:this.element.find(".container")},set:function(e){this._containerElement=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerBottom",{get:function(){return this.containerElement[0].offsetHeight+this.containerElement[0].offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerTop",{get:function(){return this.containerElement[0].offsetTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderedNodes",{get:function(){return this.containerElement[0].children},enumerable:!0,configurable:!0}),t}();angular.module("virtualIndexedListView").service("virtualIndexedListViewRenderer",["$compile","$injector","$interval","$timeout","virtualIndexedListView.getY","observeOnScope","virtualIndexedListView.transformY",t])}(VirtualIndexedListView||(VirtualIndexedListView={}));
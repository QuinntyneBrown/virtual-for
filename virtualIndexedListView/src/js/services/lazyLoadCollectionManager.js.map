{"version":3,"sources":["services/lazyLoadCollectionManager.ts"],"names":["VirtualIndexedListView","VirtualIndexedListView.LazyLoadCollectionManager","VirtualIndexedListView.LazyLoadCollectionManager.constructor","VirtualIndexedListView.LazyLoadCollectionManager.loaded","VirtualIndexedListView.LazyLoadCollectionManager.lastLoadedIndex","VirtualIndexedListView.LazyLoadCollectionManager.pageSize","VirtualIndexedListView.LazyLoadCollectionManager.numberOfItems","VirtualIndexedListView.LazyLoadCollectionManager.items"],"mappings":"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","file":"services/lazyLoadCollectionManager.js","sourcesContent":["/// <reference path=\"../../typings/typescriptapp.d.ts\" />\r\n\r\nmodule VirtualIndexedListView {\r\n\r\n    class LazyLoadCollectionManager implements ICollectionManager {\r\n        constructor(private $injector:ng.auto.IInjectorService, private $q: ng.IQService) {\r\n            \r\n        }\r\n\r\n        public type: collectionType = collectionType.lazyLoad;\r\n\r\n        public createInstance = (options: ILazyLoadCollectionManagerInstanceOptions) => {            \r\n            var instance = new LazyLoadCollectionManager(this.$injector,this.$q);\r\n            instance.items = options.items;\r\n            instance.numberOfItems = options.items.length;            \r\n            instance.dataService = instance.$injector.get(options.dataService);\r\n            instance.dataService.search({}).then((results: any) => {\r\n                instance.numberOfItems = results.data.TotalHits;\r\n                for (var i = 0; i < results.data.TotalHits; i++) {\r\n                    instance.items.push(null);\r\n                }\r\n\r\n                for (var i = 0; i < results.data.Data.length; i++) {\r\n                    instance.items[i] = results.data.Data[i].Item;\r\n                }\r\n\r\n                for (var i = 0; i < instance.subscriptions.length; i++) {\r\n                    instance.subscriptions[i].callback();\r\n                }\r\n            });\r\n            return instance;\r\n        }\r\n\r\n        public get loaded() {\r\n            var loaded = true;\r\n\r\n            for (var i = 0; i < this.items.length; i++) {\r\n                if (this.items[i] === null) {\r\n                    loaded = false;\r\n                    i = this.items.length;\r\n                }\r\n            }\r\n            return loaded;\r\n        }\r\n\r\n        public get lastLoadedIndex() {\r\n            var index = null;\r\n\r\n            for (var i = 0; i < this.items.length; i++) {\r\n                if (this.items[i] === null && index === null) {\r\n                    index = i;\r\n                    i = this.items.length;\r\n                }\r\n            }\r\n            return index;\r\n        }\r\n\r\n        public get pageSize() {\r\n            return 128;\r\n        }\r\n\r\n        public dataService: any;\r\n\r\n        public getIndexByCriteriaAsync = (options: any) => {\r\n\r\n            var deferred = this.$q.defer();\r\n\r\n            var index = null;\r\n\r\n            for (var i = 0; i < this.items.length; i++) {\r\n                if (this.items[i][options.criteria.key] == options.criteria.value) {\r\n                    index = i;\r\n                }\r\n            }\r\n\r\n            deferred.resolve({ index: index });\r\n\r\n            return deferred.promise;\r\n        }\r\n\r\n        private _numberOfItems: number;\r\n\r\n        public get numberOfItems() {\r\n            return this._numberOfItems;\r\n        }\r\n\r\n        public set numberOfItems(value: number) {\r\n            this._numberOfItems = value;\r\n        }\r\n\r\n        private _items: any[];\r\n\r\n        public get items() {\r\n            return this._items;\r\n        }\r\n\r\n        public loadMore = () => {\r\n            var lastLoadIndex = this.lastLoadedIndex;\r\n\r\n            if (!this.loaded) {\r\n                this.dataService.search({ params: { offset: lastLoadIndex, pageSize : this.pageSize } }).then((results:any) => {\r\n                    for (var i = 0; i < results.data.Data.length; i++) {\r\n                        this.items[i + lastLoadIndex] = results.data.Data[i].Item;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        public set items(value: any[]) {\r\n            this._items = value;\r\n        }\r\n\r\n        public subscriptions: ISubscription[] = [];\r\n\r\n        public subscribe = (options: ISubscribeOptions) => {\r\n            this.subscriptions.push({\r\n                callback: options.callback,\r\n                id: this.subscriptions.length + 1,\r\n                isActive: true\r\n            });\r\n            return this.subscriptions.length;\r\n        }\r\n    }\r\n\r\n    angular.module(\"virtualIndexedListView\").service(\"virtualIndexedListView.lazyLoadCollectionManager\", [\"$injector\",\"$q\", LazyLoadCollectionManager]);\r\n} "],"sourceRoot":"/source/"}